{% extends "base.html" %}
{% load static %}

{% block conteudo %}
<form method="post" id="diarioForm">
  {% csrf_token %}
  <h5 class="mt-4"></h5>
  <div class="row g-3">
    <h5 class="mt-4">Especifica√ß√£o Obra</h5>
    <!-- Contrato -->
    <div class="col-md-6">
      <label for="contratoSelect" class="form-label fw-semibold small">Contrato</label>
      {{ form.contratos }}
    </div>

    <!-- Obra -->
    <div class="col-md-6">
      <label for="obraSelect" class="form-label fw-semibold small">Obra</label>
      <select id="obraSelect" name="obra" class="form-select form-select-sm" required>
        <option value="">-- Selecione a obra --</option>
      </select>
    </div>
  </div>

  <!-- Data -->
  <h5 class="mt-4">Data</h5>
  <div class="col-md-3">
      {{ form.dia }}
  </div>
  
  <hr>
  <!-- Climas -->
  <h5 class="mt-4">Tempo/Turno</h5>
  <div class="row g-3 mt-3">

    <div class="col-md-3">
      <label class="form-label fw-semibold small">{{ form.clima_manha.label }}</label>
      {% for radio in form.clima_manha %}
        <div class="form-check">
          {{ radio.tag }}
          <label class="form-check-label">{{ radio.choice_label }}</label>
        </div>
      {% endfor %}
    </div>

    <div class="col-md-3">
      <label class="form-label fw-semibold small">{{ form.clima_tarde.label }}</label>
      {% for radio in form.clima_tarde %}
        <div class="form-check">
          {{ radio.tag }}
          <label class="form-check-label">{{ radio.choice_label }}</label>
        </div>
      {% endfor %}
    </div>

    <div class="col-md-3">
      <label class="form-label fw-semibold small">{{ form.clima_noite.label }}</label>
      {% for radio in form.clima_noite %}
        <div class="form-check">
          {{ radio.tag }}
          <label class="form-check-label">{{ radio.choice_label }}</label>
        </div>
      {% endfor %}
    </div>

    <div class="col-md-3">
      <label class="form-label fw-semibold small">{{ form.clima_madrugada.label }}</label>
      {% for radio in form.clima_madrugada %}
        <div class="form-check">
          {{ radio.tag }}
          <label class="form-check-label">{{ radio.choice_label }}</label>
        </div>
      {% endfor %}
    </div>
  </div>
  <hr>
  
  <!-- Servi√ßos -->
  <h5 class="mt-4">Servi√ßos</h5>

  <div id="servicos-container">
    {{ formset_servicos.management_form }}
    {% for form in formset_servicos %}
      <div class="row g-2 align-items-end mb-2 servico-form">
        <div class="col-md-5">
          {{ form.servicos_padrao.label_tag }} {{ form.servicos_padrao }}
        </div>
        <div class="col-md-2">
          {{ form.item.label_tag }} {{ form.item }}
        </div>
        <div class="col-md-4">
          {{ form.referencia.label_tag }} {{ form.referencia }}
        </div>
        <div class="col-md-1 text-center">
          <button type="button" class="btn btn-outline-danger btn-sm remove-servico">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="mt-2">
    <button type="button" id="add-servico" class="btn btn-success btn-sm">
      <i class='bi bi-plus-circle'> Adicionar Servi√ßo </i>
    </button>
  </div>

  <hr>
  <!-- Efetivo Direto -->
  <h5 class="mt-4">Efetivo Direto</h5>

  <div class="form-check mb-2">
    <input class="form-check-input" type="checkbox" id="toggle-efetivo">
    <label class="form-check-label" for="toggle-efetivo">
      Editar efetivo direto padr√£o
    </label>
  </div>

  <!-- üîπ Efetivo Direto (escondido at√© clicar em "Editar") -->
  <div id="efetivo-container" style="display:none;">
    {{ efetivo_formset.management_form }}
    {% for form in efetivo_formset %}
    <div class="efetivo-form border rounded p-2 mb-2">
      <div class="row g-2 align-items-center">
        <div class="col-md-6">
          {{ form.funcao.label_tag }} {{ form.funcao }}
        </div>
        <div class="col-md-3">
          {{ form.qtde.label_tag }} {{ form.qtde }}
        </div>
        <div class="col-md-3">
          {{ form.presente.label_tag }} {{ form.presente }}
        </div>
        <div class="col-md-12 text-end mt-1">
          <button type="button" class="btn btn-outline-danger btn-sm remove-efetivo">Remover</button>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>


<button type="button" id="add-efetivo" class="btn btn-sm btn-primary mt-2" style="display:none;">
  Adicionar fun√ß√£o
</button>



  <div class="mt-4 text-end">
    <button type="submit" class="btn btn-primary btn-sm">Salvar Di√°rio</button>
  </div>
</form>

<!-- JS para carregar obras conforme contrato -->
<script src={% static 'contratos/js/busca_obras_por_contrato.js' %}></script>
<script src={% static 'diarios/js/cadastra_diario.js' %}></script>


{% endblock %}